<!doctype html>
<html lang="en">

<head>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-131452110-2"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-131452110-2');
  </script>
  <!-- Required Meta Tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>windowsforensics.net</title>
  <meta name="description" content="Prefetch files contain files and directories referenced by an application.">
  <link rel="shortcut icon" href="../../img/puzzle.svg" type="image/x-icon">
  <!-- CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <link rel="stylesheet" href="../../css/styles.css">
</head>

<body>
  <!-- Navigation Bar -->
  <nav class="navbar navbar-expand-lg  navbar-dark bg-dark">
    <div class="container-fluid">
      <!-- Brand -->
      <a class="navbar-brand" href='https://windowsforensics.net'>
        <i class="icon-white">
          <svg class="bi bi-puzzle-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor"
            xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd"
              d="M3.112 3.645A1.5 1.5 0 014.605 2H7a.5.5 0 01.5.5v.382c0 .696-.497 1.182-.872 1.469a.459.459 0 00-.115.118.113.113 0 00-.012.025L6.5 4.5v.003l.003.01c.004.01.014.028.036.053a.86.86 0 00.27.194C7.09 4.9 7.51 5 8 5c.492 0 .912-.1 1.19-.24a.86.86 0 00.271-.194.213.213 0 00.036-.054l.003-.01v-.008a.112.112 0 00-.012-.025.459.459 0 00-.115-.118c-.375-.287-.872-.773-.872-1.469V2.5A.5.5 0 019 2h2.395a1.5 1.5 0 011.493 1.645L12.645 6.5h.237c.195 0 .42-.147.675-.48.21-.274.528-.52.943-.52.568 0 .947.447 1.154.862C15.877 6.807 16 7.387 16 8s-.123 1.193-.346 1.638c-.207.415-.586.862-1.154.862-.415 0-.733-.246-.943-.52-.255-.333-.48-.48-.675-.48h-.237l.243 2.855A1.5 1.5 0 0111.395 14H9a.5.5 0 01-.5-.5v-.382c0-.696.497-1.182.872-1.469a.459.459 0 00.115-.118.113.113 0 00.012-.025L9.5 11.5v-.003l-.003-.01a.214.214 0 00-.036-.053.859.859 0 00-.27-.194C8.91 11.1 8.49 11 8 11c-.491 0-.912.1-1.19.24a.859.859 0 00-.271.194.214.214 0 00-.036.054l-.003.01v.002l.001.006a.113.113 0 00.012.025c.016.027.05.068.115.118.375.287.872.773.872 1.469v.382a.5.5 0 01-.5.5H4.605a1.5 1.5 0 01-1.493-1.645L3.356 9.5h-.238c-.195 0-.42.147-.675.48-.21.274-.528.52-.943.52-.568 0-.947-.447-1.154-.862C.123 9.193 0 8.613 0 8s.123-1.193.346-1.638C.553 5.947.932 5.5 1.5 5.5c.415 0 .733.246.943.52.255.333.48.48.675.48h.238l-.244-2.855z"
              clip-rule="evenodd" />
          </svg>
        </i> WINDOWSFORENSICS
      </a>
      <!-- Collapsable Toggle Button -->
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar"
        aria-controls="collapsibleNavbar" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Links -->
      <div class="collapse navbar-collapse" id="collapsibleNavbar">
        <div class="navbar-nav ml-auto">
          <a class="nav-item nav-link" href="https://windowsforensics.net/index.html">Home</a>
          <a class="nav-item nav-link active" href="https://windowsforensics.net/database.html">Database<span class="sr-only">(current)</span></a>
          <a class="nav-item nav-link" href="https://windowsforensics.net/workshops.html">Workshops</a>
          <a class="nav-item nav-link" href="https://windowsforensics.net/about.html">About</a>
        </div>
      </div>
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row content">
      <!-- Navigation Sidebar -->
      <div class="col-lg-2 text-left"></div>

      <!-- Web Page Content -->
      <div class="col-lg-8 text-left">
        <br>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="../../database.html">Database</a></li>
            <li class="breadcrumb-item"><a href="program-execution.html">Program Execution</a></li>
            <li class="breadcrumb-item active" aria-current="page">Prefetch</li>
          </ol>
        </nav>
        <div class="database">
          <h1>Prefetch</h1>
          <p><strong>Description</strong>: </p>
          <ul>
            <li>Windows Prefetch files are designed to speed up the application startup process, by pre-loading code
              pages of commonly used applications.</li>
            <li>Windows cache manager monitors all files and directories referenced for each process and maps them into
              a <strong>.pf</strong> file.
            </li>
            <li>Prefetch files are limited to 128 files on Windows XP/Windows 7 and 1024 files on Windows 8 and Windows
              10. However for my system running Windows 10.0.18362, my prefetch directory is limited to 250 entries.
            </li>
            <li>The file format for Prefetch files is &lt;NameOfExecutable&gt;-&lt;Hash&gt;.pf</li>
          </ul>
          <p><strong>Location</strong>:</p>
          <ul>
            <li>C:\Windows\Prefetch</li>
            <li>Windows Prefetch is disabled by default on Windows Server Operating Systems.</li>
          </ul>
          <p><strong>Notes</strong>:</p>
          <ul>
            <li>Each .pf will include last time of execution, number of times run, and device and file handles used by
              the program.</li>
            <li>Date/Time file by that name and path was first executed:
              <ul>
                <li>Creation Date of .pf file (~10 seconds).</li>
              </ul>
            </li>
            <li>Date/Time file by that name and path was last executed:
              <ul>
                <li>Embedded in the last run time of .pf file</li>
                <li>Last Modification date of .pf file (~10 seconds).</li>
                <li>Windows 8 and Windows 10 will also include last 8 times of execution.</li>
              </ul>
            </li>
          </ul>

          <p><strong>Analysis</strong>: A new Windows Prefetch file will be created under the following circumstances:
            <ul>
              <li>A file is executed for the first time.</li>
              <li>A file is executed from a new directory.</li>
              <li><em>A file is executed within a hosting application with new command-line parameters.</em></li>
              <ul>
                <li>The command-line is only factored into account for hosting applications such as DLLHOST.EXE, MMC.EXE, RUNDLL32.EXE and SVCHOST.EXE.</li>
              </ul>
            </ul>
            To visualize this in action, let's review how many instances of SVCHOST.exe we have running Task Manager. We
            can see that SVCHOST.exe is only executing from the C:\Windows\System32 directory as expected, but when we
            review our C:\Windows\Prefetch directory, well notice multiple entries for SVCHOST.exe. That's because a new
            prefetch entry was generated for each unique command-line used to initilize SVCHOST.exe.
            <br>
            <br>
            <img src="../../img/task-manager-svchost.png" class="img-fluid">
            <br>
            <br>
            <img src="../../img/prefetch-svchost.png" class="img-fluid">
            <br>
            <br>
            We can obtain the first and last run time just by analyzing the date created and date modified timestamps of
            the Prefetch directory within Windows Explorer. The date created is the first run time and the date modified
            is the last run time. Keep in mind that this doesn't take into account how frequently the prefetch directory
            has been over-written. Due to limitations placed on the amount of prefetch files that Windows will keep
            track of, it's possible that a file could generate a new prefetch entry even though it's been executed
            previously from a historical context.
            <br>
            <br>
            <img src="../../img/prefetch-folder.png" class="img-fluid">
            <br>
            <br>


            We can utilize <a href="https://ericzimmerman.github.io/#!index.md">PECmd</a> by Eric
            Zimmerman, to parse .pf files into a readable format and review the additional meta-data that .pf files have
            to offer. You can review the command-line options by running
            <strong>PEcmd /?</strong>.
            <br>
            <br>
            <img src="../../img/pecmd-command-line-options.png" class="img-fluid">
            <br>
            <br>
            To analyze a single prefetch file of interest, run <strong>PEcmd.exe -f</strong> followed by the location of
            the .pf file you'd like to parse. You can take advantage of tab-complete to quickly identify whether or not
            there are multiple entires for a particular file name by tabbing through the various entries.
            <br>
            <br>
            <img src="../../img/pecmd-single-file.gif" class="img-fluid">
            <br>
            <br>
            To analyze an entire directory, run <strong>PEcmd.exe -d</strong> followed by the location of the directory
            you'd like to parse. When reviewing a large number of prefetch files, it's helpful to capture the output
            inside of a .CSV file. You can append <strong>--csv "<em>DIRECTORY</em>" --csvf "<em>FILE
                NAME</em>"</strong>
            to output the analysis results to a location of your choosing.
            <br>
            <br>
            <img src="../../img/pecmd-directory.gif" class="img-fluid">
            <br>
            <br>
            We can use <a href="https://ericzimmerman.github.io/#!index.md">Timeline Explorer</a>, another helpful
            utility created by Eric Zimmerman to review the output of our directory analysis. Timeline Explorer can be
            used to view .CSV and .XLSX files and enables filtering, grouping, sorting out of the box, making analysis
            much more streamlined in my opinion as opposed to relying on Microsoft Excel.
            <br>
            <br>
            <img src="../../img/prefetch-timeline-explorer.gif" class="img-fluid">
            <br>
            <br>
          </p>
        </div>
      </div>
      <div class="col-lg-2 text-left"></div>
    </div>
  </div>
  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>

</body>

</html>
